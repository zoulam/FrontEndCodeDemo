!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);class i{constructor(e,t){this.content=e.content,this.runTime=e.runTime,this.danmu=e,this.ctx=t,this.initialize()}initialize(){this.color=this.danmu.color||this.ctx.color,this.speed=this.danmu.speed||this.ctx.speed,this.fontSize=30,this.width=function(e,t=30){const n=document.createElement("span");n.innerText=e,n.style.fontSize=t+"px",n.style.position="absolute",document.body.appendChild(n);let i=n.offsetWidth;return document.body.removeChild(n),i}(this.content,this.fontSize),function(e,t,n){let i=e.width,o=e.height*Math.random();o<t&&(o=t),o>e.height-t&&(o=e.height-t),n.x=i,n.y=o}(this.ctx.canvas,this.fontSize,this)}draw(){this.ctx.canvasCtx.font=this.fontSize+"px MicroSoft Yahei",this.ctx.canvasCtx.fillStyle=this.color,this.ctx.canvasCtx.fillText(this.content,this.x,this.y)}}class o{constructor(e,t,n){var i;e&&t&&n&&(i=n,"[object Object]"===Object.prototype.toString.call(i))&&(n.danmuData&&function(e){return Array.isArray(e)}(n.danmuData)&&(this.video=e,this.canvas=t,this.canvasCtx=t.getContext("2d"),this.canvas.width=e.offsetWidth,this.canvas.height=e.offsetHeight,this.danmuPaused=!0,Object.assign(this,n,{runTime:18,color:"red",speed:2}),this.danmuPool=this.createDanmuPool(),this.render()))}createDanmuPool(){return this.danmuData.map(e=>new i(e,this))}render(){this.clearRect(),this.drawDanmu(),!this.danmuPaused&&requestAnimationFrame(this.render.bind(this))}drawDanmu(){let e=this.video.currentTime;this.danmuPool.map(t=>{!t.stopDrawing&&e>=t.runTime&&(t.isInitialized||(t.initialize(),t.isInitialized=!0),t.x-=t.speed,t.draw(),t.x<=-1*t.width&&(t.stopDrawing=!0))})}reset(){this.clearRect();let e=this.video.currentTime;console.log(e),this.danmuPool.map(t=>{t.stopDrawing=!1,e<=t.runTime?(t.isInitialized=!1,console.log("run")):(console.log("stop"),t.stopDrawing=!0)})}addDanmu(e){this.danmuPool.push(new i(e,this))}clearRect(){this.canvasCtx.clearRect(0,0,this.canvas.width,this.canvas.height)}}const s=[{content:"我是🐖",speed:2,runTime:0,color:"green"},{content:"我是测试数据合并",speed:2},{content:"我是🐖",speed:2,runTime:10,color:"green"},{content:"我是🐖",speed:2,runTime:5,color:"green"},{content:"啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊",speed:2,runTime:7,color:"green"},{content:"好好听",speed:2,runTime:8,color:"green"}];(e=>{const t=e.getElementById("J_danmuVideo"),n=e.getElementById("J_danmuCanvas"),i=e.getElementsByClassName("danmu-input")[0],r=e.getElementsByClassName("danmu-btn")[0],a=e.getElementsByClassName("color-input")[0],u=()=>{t.addEventListener("play",c,!1),t.addEventListener("pause",d,!1),t.addEventListener("seeked",l,!1),r.addEventListener("click",h,!1)};function c(){videoDanmu.danmuPaused=!1,videoDanmu.render()}function d(){videoDanmu.danmuPaused=!0}function l(){videoDanmu.reset()}function h(){if(videoDanmu.danmuPaused)return;let e=i.value.trim();if(!e)return;let n=a.value,o=t.currentTime;console.log(o);const s={content:e,speed:2,runTime:o,color:n};videoDanmu.addDanmu(s),e=""}window.videoDanmu=new o(t,n,{danmuData:s}),u()})(document)}]);
//# sourceMappingURL=bundle.js.map